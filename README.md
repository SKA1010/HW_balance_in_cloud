# Домашнее задание к занятию «Отказоустойчивость в облаке»

### Цель задания

В результате выполнения этого задания вы научитесь:  
1. Конфигурировать отказоустойчивый кластер в облаке с использованием различных функций отказоустойчивости. 
2. Устанавливать сервисы из конфигурации инфраструктуры.

### Инструменты и дополнительные материалы, которые пригодятся для выполнения задания

1. [Документация сетевого балансировщика нагрузки](https://cloud.yandex.ru/docs/network-load-balancer/quickstart)

 ---

## Задание 1 

Возьмите за основу [решение к заданию 1 из занятия «Подъём инфраструктуры в Яндекс Облаке»](https://github.com/netology-code/sdvps-homeworks/blob/main/7-03.md#задание-1).

1. Теперь вместо одной виртуальной машины сделайте terraform playbook, который:

- создаст 2 идентичные виртуальные машины. Используйте аргумент [count](https://www.terraform.io/docs/language/meta-arguments/count.html) для создания таких ресурсов;
- создаст [таргет-группу](https://registry.terraform.io/providers/yandex-cloud/yandex/latest/docs/resources/lb_target_group). Поместите в неё созданные на шаге 1 виртуальные машины;
- создаст [сетевой балансировщик нагрузки](https://registry.terraform.io/providers/yandex-cloud/yandex/latest/docs/resources/lb_network_load_balancer), который слушает на порту 80, отправляет трафик на порт 80 виртуальных машин и http healthcheck на порт 80 виртуальных машин.

Рекомендуем изучить [документацию сетевого балансировщика нагрузки](https://cloud.yandex.ru/docs/network-load-balancer/quickstart) для того, чтобы было понятно, что вы сделали.

2. Установите на созданные виртуальные машины пакет Nginx любым удобным способом и запустите Nginx веб-сервер на порту 80.

3. Перейдите в веб-консоль Yandex Cloud и убедитесь, что: 

- созданный балансировщик находится в статусе Active,
- обе виртуальные машины в целевой группе находятся в состоянии healthy.

4. Сделайте запрос на 80 порт на внешний IP-адрес балансировщика и убедитесь, что вы получаете ответ в виде дефолтной страницы Nginx.

*В качестве результата пришлите:*

*1. Terraform Playbook.*

*2. Скриншот статуса балансировщика и целевой группы.*

*3. Скриншот страницы, которая открылась при запросе IP-адреса балансировщика.*

---

## Решение 1

Был создан файл конфигурации main.tf, из него развёрнуто 2 виртуальные машины и балансировщик в Yandex Cloud

**Балансировщик:**
![1](https://github.com/SKA1010/HW_balance_in_cloud/assets/125235217/b0b86c46-0c60-42d1-96f0-fd93a1478dbc)

**Виртуальные машины:**

![2](https://github.com/SKA1010/HW_balance_in_cloud/assets/125235217/30541be1-d80b-4181-82ed-e67d01e08a69)

На обоих серверах был установлен Nginx

**Первый сервер:**
![3-1](https://github.com/SKA1010/HW_balance_in_cloud/assets/125235217/26174e9a-c59e-4bea-970d-5e9026800eda)

**Второй сервер:**
![3-2](https://github.com/SKA1010/HW_balance_in_cloud/assets/125235217/468bab29-b28e-42f1-92d5-9a4dae6617b8)

**При запросе страницы по адресу балансировщика видим один из серверов:**
![3](https://github.com/SKA1010/HW_balance_in_cloud/assets/125235217/419bbe74-e70a-40f3-9f48-1f4cbf14f609)




